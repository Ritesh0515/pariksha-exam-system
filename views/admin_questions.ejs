<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %> <title>Question Bank | Pariksha</title>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 d-none d-md-block sidebar p-4">
            <h4 class="fw-bold mb-5">Pariksha</h4>
            <nav class="nav flex-column gap-2">
                <a class="nav-link" href="/admin/dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
                <a class="nav-link" href="/admin/subjects"><i class="bi bi-book me-2"></i> Subjects</a>
                <a class="nav-link active" href="/admin/exams"><i class="bi bi-journal-text me-2"></i> Exams</a>
            </nav>
        </div>

        <div class="col-md-10 offset-md-2 p-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                          <li class="breadcrumb-item"><a href="/admin/exams">Exams</a></li>
                          <li class="breadcrumb-item active"><%= exam.exam_name %></li>
                        </ol>
                    </nav>
                    <h2 class="fw-bold">Manage Questions</h2>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addQuestionModal">
                    <i class="bi bi-plus-lg me-2"></i>Add New MCQ
                </button>
            </div>

            <div class="row">
                <% if (questions.length === 0) { %>
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-folder2-open display-1 text-muted"></i>
                        <p class="mt-3 text-muted">No questions added yet. Click the button above to start.</p>
                    </div>
                <% } %>

                <% questions.forEach((q, index) => { %>
                    <div class="col-12 mb-3">
                        <div class="card glass-card p-4">
                            <div class="d-flex justify-content-between">
                                <h5 class="fw-bold">Q<%= index + 1 %>: <%= q.question_text %></h5>
                                <span class="badge bg-primary-subtle text-primary rounded-pill h-50">1 Mark</span>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6 mb-2">
                                    <div class="p-2 border rounded <%= q.correct_answer === 'a' ? 'bg-success-subtle border-success' : '' %>">
                                        <strong>A:</strong> <%= q.option_a %>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <div class="p-2 border rounded <%= q.correct_answer === 'b' ? 'bg-success-subtle border-success' : '' %>">
                                        <strong>B:</strong> <%= q.option_b %>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <div class="p-2 border rounded <%= q.correct_answer === 'c' ? 'bg-success-subtle border-success' : '' %>">
                                        <strong>C:</strong> <%= q.option_c %>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <div class="p-2 border rounded <%= q.correct_answer === 'd' ? 'bg-success-subtle border-success' : '' %>">
                                        <strong>D:</strong> <%= q.option_d %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addQuestionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Create New Question</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/admin/exams/<%= exam.exam_id %>/questions/add" method="POST">
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Question Description</label>
                        <textarea name="question_text" class="form-control" rows="3" placeholder="Enter your question here..." required></textarea>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6"><label>Option A</label><input type="text" name="option_a" class="form-control" required></div>
                        <div class="col-md-6"><label>Option B</label><input type="text" name="option_b" class="form-control" required></div>
                        <div class="col-md-6"><label>Option C</label><input type="text" name="option_c" class="form-control" required></div>
                        <div class="col-md-6"><label>Option D</label><input type="text" name="option_d" class="form-control" required></div>
                    </div>
                    <div class="mt-4">
                        <label class="form-label fw-bold text-success">Select Correct Answer</label>
                        <select name="correct_answer" class="form-select border-success" required>
                            <option value="a">Option A</option>
                            <option value="b">Option B</option>
                            <option value="c">Option C</option>
                            <option value="d">Option D</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary px-4">Save Question</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>